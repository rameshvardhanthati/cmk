(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>O});const n="post-message-action";function o(e,t){function o(){return"function"==typeof e?e():e}function i(e){const i=o();var r;i&&e.origin===i.origin&&e.source===i&&((r=e.data).type===n&&"object"==typeof r.action?t(e.data.action):console.warn("Unknown message received",e.data))}return window.addEventListener("message",i),{dispose:function(){window.removeEventListener("message",i)},sendAction:function(e){const t=o();if(!t)return;const i={type:n,action:e};t.postMessage(i,t.origin)}}}const i="string",r="input";const a=(s="[ext]",function(e){const t=[s,e].join(" ");function n(e){return{type:t,payload:e}}var o;return n.type=t,n.match=(o=t,function(e){return(null==e?void 0:e.type)===o}),n});var s;const c=a("control-selected"),l=a("select-control"),u=a("outline-changed"),p=a("change-property"),d=/src|.*icon$|^icon.*/i;function y(e){const t={primitiveType:"any",ui5Type:null,enumValues:null,isArray:!1};if(!e)return;const n=e.getType();if(!n)return;const o=n.getName();if(o){if(o.indexOf("[]")>0)t.primitiveType=o.substring(0,o.indexOf("[]")),t.isArray=!0;else if("void"===o||"object"===o)t.primitiveType=o;else if("any"===o)t.primitiveType="any";else if("boolean"===o||"string"===o||"int"===o||"float"===o)t.primitiveType=o;else{const e=window.sap.ui.base.DataType,n=e.getType(o);if(n&&!(n instanceof e))return t;Object.getPrototypeOf(n).getName()?t.primitiveType=Object.getPrototypeOf(n).getName():t.primitiveType="enum",t.ui5Type=o,"enum"===t.primitiveType&&(t.enumValues=jQuery.sap.getObject(t.ui5Type))}return t}}function g(e){return!e.isArray&&"any"!==e.primitiveType}function m(e){if(!("object"==typeof e&&e instanceof Object)||Array.isArray(e))return"function"==typeof e?"":e;try{return JSON.stringify(e)}catch(t){return t instanceof Error&&t.message.toLowerCase().includes("converting circular structure to json")?"<Circular JSON cannot be displayed>":e}}function f(e,t){var n,o;const a=e.getMetadata(),s=a.getName(),c=sap.ui.fl.Utils.checkControlId(e),l=t?t.getDesignTimeMetadata().getData().properties:void 0,u=a.getAllProperties(),p=Object.keys(u),f=[];for(const a of p){const p=u[a],v=y(p);if(!v)continue;let b=!1;l&&l[p.name]&&(b=l[p.name].ignore);const h={id:e.getId(),name:p.name,newValue:e.getProperty(p.name)},I=e.getBindingInfo(h.name);void 0!==(null==I?void 0:I.bindingString)&&(h.newValue=I.bindingString);const O=null!==(n=null==t?void 0:t.isSelectable())&&void 0!==n&&n&&g(v)&&c&&!b,w=m(h.newValue),C=d.test(p.name)&&"sap.m.Image"!==s&&"sap.ui.core.URI"===v.ui5Type;switch(v.primitiveType){case"enum":{const e=null!==(o=v.enumValues)&&void 0!==o?o:{},t=Object.keys(e).map((t=>({key:t,text:e[t]})));f.push({type:i,editor:"dropdown",name:p.name,value:w,isEnabled:O,options:t});break}case"string":f.push({type:i,editor:r,name:p.name,value:w,isEnabled:O,icons:C?sap.ui.core.IconPool.getIconNames().map((e=>{const t=sap.ui.core.IconPool.getIconInfo(e);return{name:e.toLowerCase(),content:t.content,fontFamily:t.fontFamily}})).sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)):[],isIcon:C});break;case"int":case"float":f.push({type:"number",editor:r,name:p.name,value:w,isEnabled:O});break;case"boolean":f.push({type:"boolean",editor:"checkbox",name:p.name,value:w,isEnabled:O})}}return{id:e.getId(),type:s,properties:f.sort(((e,t)=>e.name>t.name?1:-1))}}function v(e){return!(!e.startsWith("{")||!e.endsWith("}"))}const b=(e="")=>{let t=!1;const n=sap.ui.getCore().byId(e);if(n){let e=sap.ui.dt.OverlayRegistry.getOverlay(n);if(e&&e.getDomRef()||(e=sap.ui.dt.OverlayUtil.getClosestOverlayFor(n)),e){t=void 0!==f(e.getElementInstance(),e).properties.find((e=>!0===e.isEnabled))}}else{const n=sap.ui.getCore().getComponent(e);if(n){t=void 0!==f(n).properties.find((e=>!0===e.isEnabled))}}return t};function h(e,t){var n,o;const i=[...e],r=[];for(;i.length;){const e=i.shift(),a=b(null==e?void 0:e.id);if("element"===(null==e?void 0:e.type)){const i=(null!==(n=e.elements)&&void 0!==n?n:[]).flatMap((e=>{var t;return"aggregation"===e.type&&null!==(t=e.elements)&&void 0!==t?t:[]})),{text:s}=t(e.id),c={controlId:e.id,controlType:e.technicalName,name:null!=s?s:e.technicalName.split(".").slice(-1)[0],editable:a,visible:null===(o=e.visible)||void 0===o||o,children:h(i,t)};r.push(c)}}return r}async function I(e,t){const n=await e.getService("outline");n.attachEvent("update",(async function(){const e=h(await n.get(),(e=>{const t=sap.ui.getCore().byId(e);if(t&&t.getMetadata().getProperty("text")){const e=t.getProperty("text");return"string"==typeof e&&""!==e.trim()?{text:e}:{}}return{}}));t(u(e))}))}function O(e){console.log("Initializing Control Property Editor");const{rta:t}=e;try{const{sendAction:n}=o(window.parent,(async function(o){if(p.match(o))await async function(e,t){const{layer:n,componentId:o,rta:i,generator:r}=e,a=sap.ui.getCore().byId(t.controlId);if(!a)return;const s={layer:n,developerMode:!0,baseId:o,projectId:"",scenario:"FE_FROM_SCRATCH"},c="string"==typeof t.value&&v(t.value)?"BindProperty":"Property",l="string"==typeof t.value&&v(t.value)?{propertyName:t.propertyName,newBinding:t.value}:{propertyName:t.propertyName,newValue:t.value},u=await sap.ui.rta.command.CommandFactory.getCommandFor(a,c,l,null,s);u.getPreparedChange().getDefinition().support.generator=r,await i.getCommandStack().pushAndExecute(u)}(e,o.payload);else if(l.match(o)){const e=o.payload,i=sap.ui.getCore().byId(e);if(!i){const t=sap.ui.getCore().getComponent(e);if(t){const e=f(t),o=c(e);n(o)}return}let r=sap.ui.dt.OverlayRegistry.getOverlay(i);const a=t.getSelection();if(a.length>0)for(let e=0;e<a.length;e++)a[e].setSelected(!1);if(r&&r.getDomRef()||(r=sap.ui.dt.OverlayUtil.getClosestOverlayFor(i)),r&&r.isSelectable())r.setSelected(!0);else{const e=f(i),t=c(e);n(t)}}}));t.attachSelectionChange(function(e){return function(t){const n=t.getParameter("selection");if(Array.isArray(n)&&1===n.length){const t=sap.ui.getCore().byId(n[0].getId());if(t){const n=f(t.getElementInstance(),t),o=c(n);e(o)}}}}(n)),I(t,n)}catch(e){console.error("Error during initialization of Control Property Editor",e)}}self["ui5-adaptation"]=t})();